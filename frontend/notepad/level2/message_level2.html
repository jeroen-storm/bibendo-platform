<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bericht - Level 2</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
</head>
<body>
    <div class="container">
        <div class="status-message" id="statusMessage"></div>
        
        <div id="aggregatedContent" class="aggregated-content">
            <!-- Aggregated content will be loaded here -->
        </div>
        
        <div class="question">
            <p>Formuleer een duidelijke boodschap op basis van jouw analyse. Wat wil je overbrengen?</p>
        </div>
        
        <div class="form-group">
            <label for="noteTextarea">Hoofdboodschap:</label>
            <textarea 
                id="noteTextarea" 
                placeholder="Formuleer je hoofdboodschap..."
                maxlength="2000"
            ></textarea>
            <div class="char-counter">0/2000</div>
        </div>
        
        <div class="question">
            <p>Hoe ga je deze boodschap effectief communiceren?</p>
        </div>
        
        <div class="form-group">
            <label for="communicationTextarea">Communicatiestrategie:</label>
            <textarea 
                id="communicationTextarea" 
                placeholder="Beschrijf je communicatiestrategie..."
                maxlength="2000"
            ></textarea>
            <div class="char-counter">0/2000</div>
        </div>
        
        <div class="question">
            <p>Welke reacties verwacht je en hoe ga je daarmee om?</p>
        </div>
        
        <div class="form-group">
            <label for="reactionsTextarea">Verwachte reacties:</label>
            <textarea 
                id="reactionsTextarea" 
                placeholder="Anticipeer op mogelijke reacties..."
                maxlength="2000"
            ></textarea>
            <div class="char-counter">0/2000</div>
        </div>
        
        <div class="nav-buttons">
            <button type="button" class="btn" id="saveButton" style="width: 100%;">
                Opslaan
            </button>
        </div>
    </div>
    
    <script src="../../assets/js/notepad.js"></script>
    <script>
        
        // Custom save functionality for multiple textareas
        document.getElementById('saveButton').addEventListener('click', async () => {
            const manager = new NotepadManager();
            const textareas = ['noteTextarea', 'communicationTextarea', 'reactionsTextarea'];
            const content = {};
            
            textareas.forEach(id => {
                const textarea = document.getElementById(id);
                if (textarea) {
                    content[id] = textarea.value;
                }
            });
            
            try {
                const response = await fetch('/api/notes/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: manager.userId,
                        pageId: 'message_level2',
                        content: JSON.stringify(content),
                        editCount: manager.editCount,
                        timeSpent: manager.calculateTimeSpent()
                    })
                });
                
                if (response.ok) {
                    manager.showStatusMessage('Bericht succesvol opgeslagen!', 'success');
                } else {
                    throw new Error('Failed to save message');
                }
            } catch (error) {
                console.error('Error saving message:', error);
                manager.showStatusMessage('Er is een fout opgetreden bij het opslaan.', 'error');
            }
        });
    </script>
</body>
</html>